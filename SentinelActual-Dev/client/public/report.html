<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta name="description" content="Autogenerated report">
    <meta name="author" content="Alan Sugarbabes">
    <title>Threat analysis report</title>
    <link media="screen" href="../src/css/screen.css" rel="stylesheet">
    <link media="print" href="../src/css/print.css" rel="stylesheet">
    <!-- Bootstrap core CSS -->
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
</head>

<body>

    <nav class="navbar navbar-expand-md fixed-top">
        <h2 style="color: white;"><strong>Sentinel</strong></h2>
        <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarsExampleDefault" aria-controls="navbarsExampleDefault" aria-expanded="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
        </button>

        <div class="collapse navbar-collapse" id="navbarsExampleDefault">
            <ul class="navbar-nav mr-auto">
                <li class="nav-item active">
                    <a class="nav-link" href="#"> </a>
                </li>
            </ul>
        </div>
    </nav>

    <!-- load JSON data -->

    <script>
        const urlParams = new URLSearchParams(location.search);
        const documentTitle = urlParams.get('name');
        const fileName = urlParams.get('Title');
        const totalWordCount = urlParams.get('count');
        const word = urlParams.getAll('word') // Will store multiple words in an array
        const wordcount = urlParams.getAll('count') // Will store all word counts in an array        
        var wordcountNumbers = wordcount.map(Number); // convert String to Integer
        // Get sum total of words
        var total = 0;
        for (var i in wordcountNumbers) {
            total += wordcountNumbers[i];
        }

        var actualKeywordTotal = (total - totalWordCount);
    </script>


    <main role="main" class="container">
        <!-- Title header -->
        <div class="align-right mt-5 pt-5">
            <h1><span id="documentTitle"> </span><!-- insert variable for document name here -->
                <script>
                    document.getElementById("documentTitle").innerHTML = documentTitle;

                </script>
            </h1>
            <h2>Analysis of <span id="fileName"> </span><!-- insert variable for document name here -->
                <script>
                    document.getElementById("fileName").innerHTML = fileName;

                </script>
            </h2>
        </div>
        <div class="row">Report generated&nbsp;<span id="today"></span></div> <!-- insert datestamp that this page was generated -->
        <br>

        <!--   2 column layout  -->
        <div class="row">
            <!-- Left hand column  -->
            <div class="col-3 list group" id="listOfWords">
                <script>
                    document.write(word.length + ' Unique keywords found');

                </script>
                <ul id="ul-test"></ul> <!-- bulleted list of keywords  -->
                <script>
                    ul = document.getElementById("ul-test");
                    for (var i = 0, len = word.length; i < len; i++) {
                        var li = document.createElement("li");
                        var text = document.createTextNode(word[i]);
                        var textPart2 = document.createTextNode(wordcountNumbers[i+1]);
                        var openBracket = document.createTextNode(" (");
                        var closeBracket = document.createTextNode(")"); 
                        li.appendChild(text);
                        li.appendChild(openBracket);
                        li.appendChild(textPart2);
                        li.appendChild(closeBracket);
                        ul.appendChild(li);
                    }
                </script>
            </div>

            <!-- Right hand column  -->
            <div class="col-9 text-center">
                <script>
                    let totalKeywords = word.length;
                    let threatPercentage = (100 / totalWordCount) * actualKeywordTotal;
                    let percentage = Math.round(threatPercentage);
                    let minusPercentage = 100 - percentage;
                    document.write('<h2>' + totalWordCount + ' words in document &nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ' + actualKeywordTotal + ' keywords flagged</h2>');

                </script>
                <br>

                <!-- Pie chart -->
                <span class="wrapper hideMe">
                    <script>
                        document.write('<div class="pie start-0 end-' + percentage + '"></div>');
                        document.write('<div class="pie big start-' + percentage + ' end-' + minusPercentage + '"></div>');
                        document.write('<div class="pie over"><span>' + percentage + '%</span></div>');

                    </script>
                </span>
                <div id="sensitive">
                    <img src="Sensitive.png">
                </div>
                <br><br><br>
                <span class="hideMe"><button class="btn btn-primary hidden-print" onclick="myFunction()">Print report</button></span>

            </div>

        </div>

    </main><!-- /.container -->

    <!-- generate datestamp  -->
    <script>
        var d = new Date();
        document.getElementById("today").innerHTML = d.toLocaleString();

        function myFunction() {
            window.print();
        }

    </script>
</body>

</html>
